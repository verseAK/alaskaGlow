<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alaska Glow ‚Äî Aurora Forecast for Tonight</title>
<meta name="description" content="Will you see the northern lights tonight in Alaska? Real-time aurora forecast for Fairbanks, Anchorage, Palmer, Denali, Kenai, and Juneau with cloud cover and viewing conditions.">
<meta property="og:title" content="Alaska Glow ‚Äî Aurora Forecast for Tonight">
<meta property="og:description" content="Will you see the northern lights tonight? Real-time aurora conditions for 7 Alaska locations.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://alaskaglow.com">
<meta property="og:site_name" content="Alaska Glow">
<meta name="twitter:card" content="summary_large_image">
<link rel="canonical" href="https://alaskaglow.com">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Fraunces:opsz,wght@9..144,300;9..144,500;9..144,700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
<style>
:root{--bg:#050a0f;--card:#0c1a1f;--card-h:#112228;--grn:#2ecc71;--ylw:#f1c40f;--orn:#e67e22;--red:#e74c3c;--t1:#e8f0f2;--t2:#8ba4ad;--t3:#4a6670;--ag:#4ade80;--at:#2dd4bf;--ap:#a78bfa;--brd:#1a2e35}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;overflow-x:hidden}
.abg{position:fixed;inset:0;z-index:0;overflow:hidden;pointer-events:none}
.ab{position:absolute;width:200%;height:300px;top:-80px;left:-50%;filter:blur(60px);animation:ad 20s ease-in-out infinite}
.ab:nth-child(1){background:radial-gradient(ellipse at center,rgba(46,204,113,.12),rgba(45,212,191,.06) 30%,rgba(167,139,250,.04) 60%,transparent 80%)}
.ab:nth-child(2){top:-40px;animation-delay:-7s;animation-duration:25s;opacity:.7;background:radial-gradient(ellipse at center,rgba(45,212,191,.1),rgba(167,139,250,.06) 40%,transparent 70%)}
.ab:nth-child(3){top:-120px;animation-delay:-14s;animation-duration:30s;opacity:.5;background:radial-gradient(ellipse at center,rgba(167,139,250,.08),rgba(46,204,113,.04) 40%,transparent 70%)}
@keyframes ad{0%,100%{transform:translateX(-10%) rotate(-2deg)}33%{transform:translateX(5%) rotate(1deg)}66%{transform:translateX(-5%) rotate(-1deg)}}
.star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;animation:tw 3s ease-in-out infinite}
@keyframes tw{0%,100%{opacity:.3}50%{opacity:.8}}
.c{position:relative;z-index:1;max-width:900px;margin:0 auto;padding:0 20px}
header{padding:40px 0 16px;text-align:center}
.logo{font-family:'Fraunces',serif;font-size:2.2rem;font-weight:700;background:linear-gradient(135deg,var(--ag),var(--at),var(--ap));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-.02em;margin-bottom:4px;cursor:pointer}
.tagline{font-size:.95rem;color:var(--t2);font-weight:300}

/* Dark/daylight banner */
.now-banner{text-align:center;padding:10px 16px;border-radius:10px;font-size:.85rem;margin:8px 0 0}
.now-banner.is-dark{background:rgba(46,204,113,.1);border:1px solid rgba(46,204,113,.2);color:var(--ag)}
.now-banner.is-light{background:rgba(241,196,15,.06);border:1px solid rgba(241,196,15,.15);color:var(--ylw)}
.now-banner.is-summer{background:rgba(167,139,250,.08);border:1px solid rgba(167,139,250,.15);color:var(--ap)}

.loading{text-align:center;padding:80px 20px}
.spinner{width:40px;height:40px;border:3px solid var(--brd);border-top-color:var(--ag);border-radius:50%;animation:sp 1s linear infinite;margin:0 auto 16px}
@keyframes sp{to{transform:rotate(360deg)}}
.sl{font-size:.8rem;font-weight:500;text-transform:uppercase;letter-spacing:.12em;color:var(--t3);margin:32px 0 16px;padding-left:4px}
.upd{text-align:center;font-size:.75rem;color:var(--t3);margin-bottom:8px}

/* Hero */
.hero{margin:20px 0;padding:28px;border-radius:20px;text-align:center;cursor:pointer;transition:transform .2s}
.hero:hover{transform:scale(1.01)}
.lv-g{background:linear-gradient(135deg,rgba(46,204,113,.15),rgba(45,212,191,.08));border:1px solid rgba(46,204,113,.3)}
.lv-p{background:linear-gradient(135deg,rgba(241,196,15,.12),rgba(241,196,15,.04));border:1px solid rgba(241,196,15,.25)}
.lv-c{background:linear-gradient(135deg,rgba(230,126,34,.12),rgba(230,126,34,.04));border:1px solid rgba(230,126,34,.25)}
.lv-u{background:linear-gradient(135deg,rgba(231,76,60,.1),rgba(231,76,60,.03));border:1px solid rgba(231,76,60,.2)}
.hero-ey{font-size:.8rem;font-weight:500;text-transform:uppercase;letter-spacing:.12em;color:var(--t2);margin-bottom:10px}
.hero-loc{font-family:'Fraunces',serif;font-size:1.5rem;font-weight:500;margin-bottom:6px}
.hero-v{font-size:1.02rem;margin-bottom:14px;line-height:1.5}
.hero-d{font-size:.83rem;color:var(--t2)}.hero-d strong{color:var(--t1);font-weight:500}

/* Outlook */
.olstrip{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.olcard{background:var(--card);border:1px solid var(--brd);border-radius:14px;padding:14px 12px;text-align:center;transition:all .2s}
.olcard:hover{background:var(--card-h)}
.olcard.ist{border-color:rgba(255,255,255,.12)}
.olday{font-size:.72rem;font-weight:500;color:var(--t2);margin-bottom:8px;text-transform:uppercase;letter-spacing:.06em}
.oldot{width:16px;height:16px;border-radius:50%;margin:0 auto 8px}
.oldot.dg{background:var(--grn);box-shadow:0 0 14px var(--grn)}.oldot.dp{background:var(--ylw);box-shadow:0 0 14px var(--ylw)}
.oldot.dc{background:var(--orn);box-shadow:0 0 14px var(--orn)}.oldot.du{background:var(--red);box-shadow:0 0 10px var(--red)}
.ollbl{font-size:.82rem;font-weight:500;margin-bottom:3px}.oldesc{font-size:.72rem;color:var(--t3);line-height:1.4}

/* Location cards */
.lgrid{display:grid;grid-template-columns:1fr;gap:12px;margin-bottom:24px}
@media(min-width:600px){.lgrid{grid-template-columns:1fr 1fr}}
.lcard{background:var(--card);border:1px solid var(--brd);border-radius:16px;padding:18px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.lcard:hover{background:var(--card-h);transform:translateY(-2px);border-color:rgba(255,255,255,.1)}
.lcard::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;border-radius:4px 0 0 4px}
.lcard.lv-g::before{background:var(--grn)}.lcard.lv-p::before{background:var(--ylw)}.lcard.lv-c::before{background:var(--orn)}.lcard.lv-u::before{background:var(--red)}
.ch{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.cn{font-weight:600;font-size:1.02rem}
.ci{width:12px;height:12px;border-radius:50%;flex-shrink:0}
.lv-g .ci{background:var(--grn);box-shadow:0 0 12px var(--grn)}.lv-p .ci{background:var(--ylw);box-shadow:0 0 12px var(--ylw)}
.lv-c .ci{background:var(--orn);box-shadow:0 0 12px var(--orn)}.lv-u .ci{background:var(--red);box-shadow:0 0 12px var(--red)}
.cv{font-size:.88rem;color:var(--t2);line-height:1.5;margin-bottom:8px}
.cm{display:flex;gap:12px;font-size:.76rem;color:var(--t3);flex-wrap:wrap}.cm span{display:flex;align-items:center;gap:4px}

/* Alert */
.asec{margin:32px 0;background:linear-gradient(135deg,rgba(45,212,191,.08),rgba(167,139,250,.05));border:1px solid rgba(45,212,191,.2);border-radius:16px;padding:24px;text-align:center}
.atitle{font-family:'Fraunces',serif;font-size:1.2rem;font-weight:500;margin-bottom:6px}
.adesc{font-size:.88rem;color:var(--t2);margin-bottom:18px;max-width:420px;margin-left:auto;margin-right:auto;line-height:1.5}
.aform{display:flex;gap:8px;max-width:400px;margin:0 auto}
.ainput{flex:1;padding:11px 14px;border-radius:10px;border:1px solid var(--brd);background:var(--bg);color:var(--t1);font-family:'Outfit',sans-serif;font-size:.88rem;outline:none;transition:border-color .2s}
.ainput:focus{border-color:var(--at)}.ainput::placeholder{color:var(--t3)}
.abtn{padding:11px 18px;border-radius:10px;border:none;background:linear-gradient(135deg,var(--at),var(--ag));color:var(--bg);font-family:'Outfit',sans-serif;font-weight:600;font-size:.88rem;cursor:pointer;transition:all .2s;white-space:nowrap}
.abtn:hover{transform:scale(1.03);box-shadow:0 0 20px rgba(45,212,191,.3)}
.aok{display:none;color:var(--ag);font-size:.88rem;margin-top:10px}
.aerr{display:none;color:var(--red);font-size:.85rem;margin-top:8px}

/* Last night */
.lnsec{margin:32px 0;background:var(--card);border:1px solid var(--brd);border-radius:16px;padding:22px}
.lnh{display:flex;align-items:center;gap:10px;margin-bottom:6px}.lnh h3{font-size:.95rem;font-weight:600}
.lnd{font-size:.85rem;color:var(--t2);line-height:1.5}

/* Tours */
.tgrid{display:grid;grid-template-columns:1fr;gap:12px}
@media(min-width:600px){.tgrid{grid-template-columns:1fr 1fr}}
.tcard{background:var(--card);border:1px solid var(--brd);border-radius:14px;padding:16px;display:flex;gap:12px;align-items:center;text-decoration:none;color:inherit;transition:all .2s}
.tcard:hover{background:var(--card-h);border-color:rgba(255,255,255,.1);transform:translateY(-1px)}
.ticon{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;background:rgba(45,212,191,.1)}
.tinfo h3{font-size:.88rem;font-weight:600;margin-bottom:2px}.tinfo p{font-size:.78rem;color:var(--t2);line-height:1.4}
.text-link{font-size:.72rem;color:var(--at);margin-top:2px;display:block}

/* SEO */
.seosec{margin:40px 0;padding:24px;background:var(--card);border:1px solid var(--brd);border-radius:16px}
.seosec h2{font-family:'Fraunces',serif;font-size:1.2rem;font-weight:500;margin-bottom:10px}
.seosec p{font-size:.88rem;color:var(--t2);line-height:1.7;margin-bottom:10px}.seosec p:last-child{margin-bottom:0}

/* Detail page */
.det{display:none}.det.active{display:block}
.back{display:inline-flex;align-items:center;gap:6px;color:var(--t2);font-size:.85rem;cursor:pointer;padding:8px 0;margin-bottom:12px;border:none;background:none;font-family:'Outfit',sans-serif;transition:color .2s}.back:hover{color:var(--t1)}
.dhero{padding:28px;border-radius:20px;margin-bottom:20px;text-align:center}
.dname{font-family:'Fraunces',serif;font-size:1.7rem;font-weight:500;margin-bottom:6px}
.dverdict{font-size:1.05rem;margin-bottom:14px;line-height:1.5}
.dstats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:18px}
.dstat{text-align:center}.dsv{font-size:1.3rem;font-weight:600;margin-bottom:2px}.dsl{font-size:.72rem;color:var(--t3);text-transform:uppercase;letter-spacing:.06em}
.icard{background:var(--card);border:1px solid var(--brd);border-radius:14px;padding:18px;margin-bottom:12px}
.icard h3{font-size:.88rem;font-weight:600;margin-bottom:6px;display:flex;align-items:center;gap:8px}
.icard p{font-size:.83rem;color:var(--t2);line-height:1.6}
.slist{list-style:none;padding:0}.slist li{padding:9px 0;border-bottom:1px solid var(--brd);font-size:.85rem}
.slist li:last-child{border-bottom:none}.sn{font-weight:600;color:var(--t1)}.sd{color:var(--t2);margin-top:2px;line-height:1.4}
.sbtn{display:inline-flex;align-items:center;gap:6px;padding:9px 16px;border-radius:10px;border:1px solid var(--brd);background:var(--card);color:var(--t2);font-family:'Outfit',sans-serif;font-size:.83rem;cursor:pointer;transition:all .2s;margin-top:14px}
.sbtn:hover{background:var(--card-h);color:var(--t1);border-color:var(--at)}
.olocs{display:flex;gap:8px;overflow-x:auto;padding-bottom:8px;margin:12px 0}
.ochip{flex-shrink:0;padding:7px 14px;border-radius:20px;background:var(--card);border:1px solid var(--brd);font-size:.8rem;color:var(--t2);cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:6px}
.ochip:hover{background:var(--card-h);color:var(--t1)}
.cdot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.nerd{cursor:pointer}.ndata{display:none;margin-top:8px}
footer{text-align:center;padding:40px 0;font-size:.76rem;color:var(--t3);line-height:1.7}footer a{color:var(--t2);text-decoration:none}footer a:hover{color:var(--t1)}
</style>
</head>
<body>
<div class="abg"><div class="ab"></div><div class="ab"></div><div class="ab"></div><div class="stars" id="stars"></div></div>
<div class="c">
<header>
  <div class="logo" onclick="nav('')">Alaska Glow</div>
  <div class="tagline">Will you see the northern lights tonight?</div>
</header>

<div id="nowBanner" class="now-banner" style="display:none;"></div>

<div id="loading" class="loading"><div class="spinner"></div><div style="color:var(--t2);font-size:.9rem;">Checking aurora conditions...</div></div>

<div id="dash" style="display:none;">
  <div class="upd" id="upd"></div>
  <div id="heroCard" class="hero lv-p">
    <div class="hero-ey">‚ú¶ Best spot tonight</div>
    <div class="hero-loc" id="heroLoc">‚Äî</div>
    <div class="hero-v" id="heroV"></div>
    <div class="hero-d" id="heroD"></div>
  </div>

  <div class="sl">3-Night Outlook</div>
  <div class="olstrip" id="olstrip"></div>

  <div class="sl">All locations tonight</div>
  <div class="lgrid" id="lgrid"></div>

  <div id="lnSec" class="lnsec" style="display:none;">
    <div class="lnh"><span style="font-size:1.1rem;">üåå</span><h3 id="lnTitle"></h3></div>
    <div class="lnd" id="lnDesc"></div>
  </div>

  <div class="asec">
    <div class="atitle">Get notified when it's go time</div>
    <div class="adesc">We'll email you when conditions look great. No spam, just glow.</div>
    <div class="aform" id="aform"><input type="email" class="ainput" placeholder="your@email.com" id="aEmail"><button class="abtn" onclick="doSignup('aEmail','aform','aok','aerr','all')">Notify me</button></div>
    <div class="aok" id="aok">You're on the list! We'll let you know when the sky lights up.</div>
    <div class="aerr" id="aerr"></div>
  </div>

  <div class="sl">Aurora experiences in Alaska</div>
  <div class="tgrid">
    <a href="https://chenahotsprings.com" target="_blank" rel="noopener" class="tcard">
      <div class="ticon">‚ô®Ô∏è</div>
      <div class="tinfo"><h3>Chena Hot Springs Resort</h3><p>Soak under the aurora 60 miles outside Fairbanks. Alaska's top-rated northern lights experience.</p><span class="text-link">chenahotsprings.com ‚Üó</span></div>
    </a>
    <a href="https://www.roamalaska.com" target="_blank" rel="noopener" class="tcard">
      <div class="ticon">üì∏</div>
      <div class="tinfo"><h3>Roam Alaska ‚Äî Aurora Photo Tours</h3><p>Guided aurora photography tours from Fairbanks with warm transport and expert tips.</p><span class="text-link">roamalaska.com ‚Üó</span></div>
    </a>
    <a href="https://www.alaskaaurora.com" target="_blank" rel="noopener" class="tcard">
      <div class="ticon">üèîÔ∏è</div>
      <div class="tinfo"><h3>Alaska Aurora Adventures</h3><p>Fairbanks-based aurora viewing tours, cabin rentals, and photography workshops.</p><span class="text-link">alaskaaurora.com ‚Üó</span></div>
    </a>
    <a href="https://www.borealisbasecamp.com" target="_blank" rel="noopener" class="tcard">
      <div class="ticon">üèïÔ∏è</div>
      <div class="tinfo"><h3>Borealis Basecamp</h3><p>Glass-ceiling igloos near Fairbanks ‚Äî sleep under the aurora. Books out months ahead.</p><span class="text-link">borealisbasecamp.com ‚Üó</span></div>
    </a>
  </div>

  <div class="seosec">
    <h2>Northern Lights in Alaska ‚Äî What You Need to Know</h2>
    <p>Alaska is one of the best places on Earth to see the aurora borealis. The northern lights happen when charged particles from the sun hit Earth's atmosphere, creating curtains of green, purple, and pink light that dance across the sky.</p>
    <p>Fairbanks sits directly under the "auroral oval" and sees aurora on most clear nights from September through April. Anchorage, Palmer, and the Mat-Su Valley need stronger activity but still get spectacular shows several times per month. Denali and Talkeetna are sweet spots between the two. Juneau needs a genuine solar storm, but when it happens, aurora over the ocean is unforgettable.</p>
    <p>Four things matter: strong solar activity (we track this), clear skies (we check the weather), darkness (only visible at night), and moon phase (a bright moon washes out faint aurora). Alaska Glow combines all four into one simple answer for each location.</p>
  </div>
</div>

<div id="det" class="det"></div>

<footer>
  <div>Data from <a href="https://www.swpc.noaa.gov/" target="_blank" rel="noopener">NOAA Space Weather Prediction Center</a> & <a href="https://www.weather.gov/" target="_blank" rel="noopener">National Weather Service</a></div>
  <div style="margin-top:6px;">¬© 2026 Alaska Glow ¬∑ alaskaglow.com</div>
</footer>
</div>

<script>
const L=[
{id:'fairbanks',name:'Fairbanks',lat:64.84,lon:-147.72,kpV:1,kpG:3,drive:'5.5 hrs from Anchorage',
tag:'Under the auroral oval ‚Äî best odds in Alaska',
seo:'Fairbanks sits directly under the auroral oval, making it the best place in Alaska to see the northern lights. Aurora is visible here on most clear nights from September through April, even at low activity levels. The city has an entire tourism industry built around aurora ‚Äî lodges, hot springs, and guided photo tours all designed around the lights.',
spots:[
{n:'Chena Hot Springs',d:'Iconic. Soak in hot springs watching aurora overhead. 60 mi northeast in a natural dark sky area.'},
{n:'Cleary Summit',d:'Popular local spot on the Steese Hwy. High elevation, wide northern views. Bring a thermos.'},
{n:'Murphy Dome',d:'Old military radar site NW of town. 360¬∞ views. Rough winter road but worth it.'},
{n:'Ester Dome',d:'Just outside Fairbanks, excellent dark skies. Easy access and popular with photographers.'},
{n:'Chena Lakes Recreation Area',d:'Close to town with good horizons. Less driving than the summits.'}
]},
{id:'denali',name:'Denali Area',lat:63.73,lon:-148.91,kpV:2,kpG:3,drive:'4.5 hrs from Anchorage',
tag:'Dark skies beneath North America\'s tallest peak',
seo:'The Denali area offers dramatic aurora viewing with the northern lights dancing above the tallest peak in North America. High latitude, minimal light pollution, and stunning mountain scenery make this a photographer\'s dream. Most lodges outside the park are positioned for aurora viewing with north-facing windows and wake-up call services.',
spots:[
{n:'Denali State Park (Mile 135)',d:'Incredible views of the mountain with aurora overhead. Wide open sky at the overlooks.'},
{n:'Carlo Creek Area',d:'South of park entrance. Very dark, minimal light pollution. Several lodges cater to aurora chasers.'},
{n:'Cantwell',d:'Tiny community at the Parks/Denali Hwy junction. Extremely dark skies and easy access.'},
{n:'Wonder Lake (Late Aug‚ÄìSep only)',d:'Deep inside the park ‚Äî zero light pollution. Only accessible when road is open and nights are dark.'}
]},
{id:'talkeetna',name:'Talkeetna',lat:62.32,lon:-150.11,kpV:2,kpG:4,drive:'2.5 hrs from Anchorage',
tag:'Quirky small town, big dark skies, Denali views',
seo:'Talkeetna is a charming small town about 2.5 hours north of Anchorage that has become a popular aurora destination. Far enough to escape Anchorage light pollution, on clear nights you can see aurora with Denali as a backdrop. Great restaurants and lodges make it a more interesting base than the highway.',
spots:[
{n:'Talkeetna River Bars',d:'Walk to the riverbank for wide northern views. Gravel bars along the Susitna are natural dark sky areas.'},
{n:'Chase Trail Area',d:'South of town with great Denali views. Very few lights and classic Alaska setting.'},
{n:'Petersville Road',d:'Heads west from Trapper Creek into the mountains. Gets dark fast. Popular with locals.'}
]},
{id:'palmer-wasilla',name:'Palmer‚ÄìWasilla',lat:61.60,lon:-149.11,kpV:3,kpG:5,drive:'45 min from Anchorage',
tag:'Mat-Su Valley ‚Äî great viewing with less light pollution',
seo:'The Mat-Su Valley towns of Palmer and Wasilla are a sweet spot: close to Anchorage but far enough with less light pollution. Moderate to strong solar activity (Kp 3+) makes aurora visible, and the valley\'s wide agricultural landscapes give huge sky views Anchorage can\'t match.',
spots:[
{n:'Hatcher Pass',d:'Drive toward Independence Mine for stunning alpine aurora. Zero light pollution. Check road status ‚Äî upper road closes in winter.'},
{n:'Knik River Road',d:'East from Palmer toward the glacier. Gets dark quickly. Wide river valley views north.'},
{n:'Bodenburg Butte Trailhead',d:'Quick drive from Palmer, good northern horizon. The butte blocks southern light pollution.'},
{n:'Point Mackenzie Road',d:'West of Wasilla. Very dark and easy access.'}
]},
{id:'anchorage',name:'Anchorage',lat:61.22,lon:-149.90,kpV:3,kpG:5,drive:'‚Äî',
tag:'City lights compete, but strong storms light up the sky',
seo:'Yes, you can see the northern lights from Anchorage ‚Äî but you need to know where and when. The city\'s 300,000 residents create light pollution, so aurora needs Kp 3+ to be visible. The trick is getting to the edges of the city with dark northern horizons. During strong storms (Kp 5+), aurora fills the entire sky and you\'ll see it from downtown.',
spots:[
{n:'Glen Alps / Flattop Trailhead',d:'Above the city in the Chugach Mountains. Wide northern views. Popular and easy to reach.'},
{n:'Kincaid Park',d:'SW corner of Anchorage on the coast. Dark north and west over the inlet. Trails to open viewpoints.'},
{n:'Arctic Valley Road',d:'Up toward Arctic Valley ski area above Eagle River. Above the city glow. Excellent dark sky.'},
{n:'Earthquake Park',d:'West side overlooking the inlet. Good northern horizon, easy access. Some city glow but workable.'},
{n:'Mirror Lake (Eagle River)',d:'North of Anchorage. Aurora reflections on calm water if you time it right.'}
]},
{id:'kenai',name:'Kenai Peninsula',lat:60.55,lon:-151.26,kpV:4,kpG:5,drive:'2.5 hrs from Anchorage',
tag:'Needs stronger storms but the coastal scenery is worth the wait',
seo:'The Kenai Peninsula needs stronger solar activity (Kp 4+) to see aurora. But when it happens, the combination of mountains, coastline, and dark skies creates stunning scenes. If you\'re in Homer, Seward, or Kenai/Soldotna and a storm hits, you\'re in for a treat.',
spots:[
{n:'Homer Spit',d:'Walk out for 360¬∞ views over Kachemak Bay. Aurora reflections on the water are stunning during strong events.'},
{n:'Turnagain Pass',d:'Along the Seward Highway. High elevation, very dark, surprisingly good viewing.'},
{n:'Captain Cook State Rec Area',d:'North of Kenai on the coast. Dark skies and north-facing beaches.'},
{n:'Seward Waterfront',d:'Less light pollution than expected. Aurora over Resurrection Bay is spectacular.'}
]},
{id:'juneau',name:'Juneau',lat:58.30,lon:-134.42,kpV:5,kpG:6,drive:'Fly or ferry only',
tag:'Southeast Alaska ‚Äî rare but unforgettable when it happens',
seo:'Juneau is the hardest major Alaska city for aurora viewing ‚Äî you need a solar storm (Kp 5+) and the frequent cloud cover makes it trickier. But when a strong storm coincides with clear skies, aurora over the Gastineau Channel is absolutely spectacular. Happens a few times per season ‚Äî you need luck.',
spots:[
{n:'Mendenhall Glacier Visitor Center',d:'Open area with northern views toward the glacier. Where locals go. Check if parking is accessible after hours.'},
{n:'Douglas Island beaches',d:'Cross the bridge for less city glow. North-facing beaches have good horizon views.'},
{n:'North Douglas Highway',d:'Drive north along the coast. Dark quickly, open water views north.'},
{n:'Eaglecrest Ski Area Road',d:'Up Fish Creek Road on Douglas Island. Elevation above marine fog and low clouds.'}
]}
];

let AF=[],bestId='fairbanks',cKp=0,cBz=0,GD=null,cloudData={};

async function fj(u){try{const c=new AbortController();setTimeout(()=>c.abort(),8000);const r=await fetch(u,{signal:c.signal});if(!r.ok)throw 0;return r.json()}catch(e){return null}}

// NWS cloud cover fetch
async function fetchClouds(loc){
  try{
    const pts=await fj(`https://api.weather.gov/points/${loc.lat},${loc.lon}`);
    if(!pts||!pts.properties||!pts.properties.forecastHourly)return null;
    const fc=await fj(pts.properties.forecastHourly);
    if(!fc||!fc.properties||!fc.properties.periods)return null;
    // Get tonight's cloud cover (6pm to 6am periods)
    const now=new Date();
    const periods=fc.properties.periods;
    let tonightClouds=[];
    for(const p of periods){
      const t=new Date(p.startTime);
      const h=t.getHours();
      // Tonight = between now and 12 hours from now
      if(t>now&&t<new Date(now.getTime()+14*3600000)){
        if(p.isDaytime===false||h>=18||h<=6){
          tonightClouds.push(p.probabilityOfPrecipitation?.value||0);
          // Use shortForecast for cloud description
          if(!cloudData[loc.id]){
            cloudData[loc.id]={desc:p.shortForecast,cover:estimateCloudPct(p.shortForecast)};
          }
        }
      }
    }
    // If we got evening periods, calculate average cloud cover
    if(tonightClouds.length===0&&periods.length>0){
      // Fallback: use next nighttime period's description
      for(const p of periods){
        if(p.isDaytime===false){
          cloudData[loc.id]={desc:p.shortForecast,cover:estimateCloudPct(p.shortForecast)};
          break;
        }
      }
    }
  }catch(e){console.warn('Cloud fetch failed for',loc.name);}
}

function estimateCloudPct(desc){
  if(!desc)return 50;
  const d=desc.toLowerCase();
  if(d.includes('clear')||d.includes('sunny'))return 5;
  if(d.includes('mostly clear')||d.includes('mostly sunny'))return 15;
  if(d.includes('partly cloudy')||d.includes('partly sunny'))return 40;
  if(d.includes('mostly cloudy'))return 70;
  if(d.includes('overcast')||d.includes('cloudy'))return 90;
  if(d.includes('fog'))return 95;
  if(d.includes('snow')||d.includes('rain'))return 90;
  return 50;
}

async function loadData(){
  const [kpF,kpC,bzD]=await Promise.all([
    fj('https://services.swpc.noaa.gov/products/noaa-planetary-k-index-forecast.json'),
    fj('https://services.swpc.noaa.gov/json/planetary_k_index_1m.json'),
    fj('https://services.swpc.noaa.gov/products/solar-wind/mag-2-hour.json')
  ]);
  if(kpC&&kpC.length>0){const l=kpC[kpC.length-1];cKp=l.estimated_kp||l.kp_index||0;}
  if(bzD&&bzD.length>1){cBz=parseFloat(bzD[bzD.length-1][3])||0;}

  let fe=[];
  if(kpF&&kpF.length>1){for(let i=1;i<kpF.length;i++){const r=kpF[i],k=parseFloat(r[1]);if(!isNaN(k))fe.push({time:new Date(r[0]+' UTC'),kp:k,type:r[2]});}}

  const now=new Date(),ao=akOff(now),an=new Date(now.getTime()+ao*3600000);
  const tn=darkWin(an,64.84,-147.72);
  let tMax=cKp;
  for(const e of fe){const ea=new Date(e.time.getTime()+ao*3600000);if(ea>=tn.start&&ea<=tn.end&&e.kp>tMax)tMax=e.kp;}
  if(tMax===0)tMax=cKp;

  const nMax=[tMax];
  for(let d=1;d<=2;d++){
    const fa=new Date(an);fa.setDate(fa.getDate()+d);fa.setHours(14,0,0,0);
    const fn=darkWin(fa,64.84,-147.72);let mx=0;
    for(const e of fe){const ea=new Date(e.time.getTime()+ao*3600000);if(ea>=fn.start&&ea<=fn.end&&e.kp>mx)mx=e.kp;}
    nMax.push(mx);
  }

  // Last night
  const ya=new Date(an);ya.setDate(ya.getDate()-1);ya.setHours(14,0,0,0);
  const ln=darkWin(ya,64.84,-147.72);let lnMax=0;
  for(const e of fe){const ea=new Date(e.time.getTime()+ao*3600000);if(ea>=ln.start&&ea<=ln.end&&e.kp>lnMax)lnMax=e.kp;}

  // Fetch cloud cover in parallel (non-blocking)
  await Promise.allSettled(L.map(loc=>fetchClouds(loc)));

  // Moon phase
  const moonIllum=SunCalc.getMoonIllumination(now);
  const moonPct=Math.round(moonIllum.fraction*100);

  return{fe,tMax,nMax,lnMax,an,moonPct};
}

function akOff(d){const y=d.getUTCFullYear(),m=new Date(Date.UTC(y,2,8+(7-new Date(Date.UTC(y,2,8)).getUTCDay())%7,11)),n=new Date(Date.UTC(y,10,1+(7-new Date(Date.UTC(y,10,1)).getUTCDay())%7,10));return(d>=m&&d<n)?-8:-9;}

function darkWin(an,lat,lon){
  const t=new Date(an);t.setHours(12,0,0,0);const tm=new Date(t);tm.setDate(tm.getDate()+1);
  const st=SunCalc.getTimes(t,lat,lon),sr=SunCalc.getTimes(tm,lat,lon);
  return{start:st.nauticalDusk||st.sunset,end:sr.nauticalDawn||sr.sunrise};
}

function fmt(d){return d.toLocaleTimeString('en-US',{timeZone:'America/Anchorage',hour:'numeric',minute:'2-digit',hour12:true});}

// SCORING with cloud cover + moon
function score(loc,maxKp,bz,moonPct){
  let s=0;
  if(maxKp>=loc.kpG+2)s+=50;else if(maxKp>=loc.kpG)s+=42;else if(maxKp>=loc.kpV+1)s+=30;else if(maxKp>=loc.kpV)s+=18;else s+=4;
  if(bz<-10)s+=16;else if(bz<-5)s+=10;else if(bz<0)s+=4;
  s+=15; // darkness

  // Cloud cover adjustment
  const cl=cloudData[loc.id];
  let cloudPct=50; // default if no data
  let cloudDesc='';
  if(cl){cloudPct=cl.cover;cloudDesc=cl.desc;}
  if(cloudPct<=15)s+=15;else if(cloudPct<=35)s+=10;else if(cloudPct<=60)s+=3;else if(cloudPct<=80)s-=5;else s-=12;

  // Moon penalty
  if(moonPct>80)s-=8;else if(moonPct>50)s-=4;

  let lv,ll;
  if(s>=62){lv='g';ll='Great chance';}
  else if(s>=38){lv='p';ll='Possible';}
  else if(s>=22){lv='c';ll='Worth checking';}
  else{lv='u';ll='Unlikely';}

  const dw=darkWin(new Date(new Date().getTime()+akOff(new Date())*3600000),loc.lat,loc.lon);
  const v=verdict(loc,maxKp,bz,lv,cloudPct,cloudDesc,moonPct);
  return{...loc,score:s,lv,ll,v,kp:maxKp,dw,cloudPct,cloudDesc,moonPct};
}

function verdict(loc,kp,bz,lv,cloudPct,cloudDesc,moonPct){
  const cloudBit=cloudPct<=20?'Clear skies expected.':cloudPct<=40?'Partly cloudy ‚Äî gaps should work.':cloudPct<=65?'Cloudy patches tonight ‚Äî some breaks possible.':cloudPct<=85?'Mostly overcast ‚Äî might clear up late.':'Heavy clouds expected ‚Äî tough viewing.';
  const moonBit=moonPct>80?' Bright moon may wash out fainter aurora.':moonPct>50?' Half moon in the sky ‚Äî strong displays will still show.':'';

  if(lv==='g'){
    if(kp>=loc.kpG+2)return`Strong activity tonight ‚Äî expect vivid, dancing aurora. ${cloudBit}${moonBit}`;
    return`Good conditions lining up tonight. ${cloudBit} Look north after dark.${moonBit}`;
  }
  if(lv==='p'){
    if(kp>=loc.kpV+1)return`Activity above the threshold for ${loc.name}. ${cloudBit} Worth stepping outside.${moonBit}`;
    return`Moderate activity ‚Äî a faint glow is possible. ${cloudBit}${moonBit}`;
  }
  if(lv==='c'){
    if(cloudPct>70)return`Solar activity is there but clouds are the problem tonight. ${cloudBit} Keep checking ‚Äî gaps happen.`;
    return`Activity is at the edge for ${loc.name}. ${cloudBit} Quick check after dark ‚Äî you might get lucky.${moonBit}`;
  }
  if(cloudPct>70)return`Low activity and cloudy tonight. Not the night for ${loc.name}.`;
  return`Activity below what ${loc.name} needs. Probably quiet, but storms can ramp up fast.${moonBit}`;
}

// IS IT DARK RIGHT NOW
function renderBanner(){
  const ban=document.getElementById('nowBanner');
  const now=new Date();
  const ao=akOff(now);
  const an=new Date(now.getTime()+ao*3600000);
  const month=an.getMonth(); // 0-indexed

  // Summer check (May through mid-August)
  if(month>=4&&month<=7){
    ban.className='now-banner is-summer';
    ban.innerHTML='‚òÄÔ∏è Aurora season runs September through April. Alaska has near-24-hour daylight right now.';
    ban.style.display='block';
    return;
  }

  const sun=SunCalc.getTimes(now,64.84,-147.72);
  const isDark=now<sun.sunrise||now>sun.sunset;
  ban.style.display='block';
  if(isDark){
    ban.className='now-banner is-dark';
    ban.innerHTML='üåô It\'s dark in Alaska right now ‚Äî go outside and look north!';
  } else {
    ban.className='now-banner is-light';
    const dusk=sun.nauticalDusk||sun.sunset;
    ban.innerHTML=`‚òÄÔ∏è Daylight in Alaska right now. Gets dark around ${fmt(dusk)} ‚Äî tonight's forecast is below.`;
  }
}

// RENDER DASHBOARD
function renderDash(forecasts,data){
  document.getElementById('loading').style.display='none';
  document.getElementById('dash').style.display='block';
  renderBanner();

  forecasts.sort((a,b)=>b.score-a.score);
  AF=forecasts;bestId=forecasts[0].id;

  document.getElementById('upd').textContent=`Updated ${fmt(new Date())} Alaska time ¬∑ Moon ${data.moonPct}% illuminated`;

  // Hero
  const b=forecasts[0];
  const h=document.getElementById('heroCard');
  h.className=`hero lv-${b.lv}`;h.onclick=()=>nav(b.id);
  document.getElementById('heroLoc').textContent=b.name;
  document.getElementById('heroV').textContent=b.v;
  let heroExtra=`<strong>Dark window:</strong> ${fmt(b.dw.start)} ‚Äì ${fmt(b.dw.end)}`;
  if(b.cloudDesc)heroExtra+=` ¬∑ <strong>Sky:</strong> ${b.cloudDesc}`;
  document.getElementById('heroD').innerHTML=heroExtra;

  // Outlook
  renderOL(data);

  // Cards
  const g=document.getElementById('lgrid');g.innerHTML='';
  for(const f of forecasts){
    const d=document.createElement('div');
    d.className=`lcard lv-${f.lv}`;d.onclick=()=>nav(f.id);
    let meta=`<span>üåô ${fmt(f.dw.start)}</span><span>${f.ll}</span>`;
    if(f.cloudDesc)meta+=`<span>‚òÅÔ∏è ${f.cloudDesc}</span>`;
    if(f.drive&&f.drive!=='‚Äî')meta+=`<span>üöó ${f.drive}</span>`;
    d.innerHTML=`<div class="ch"><div class="cn">${f.name}</div><div class="ci"></div></div><div class="cv">${f.v}</div><div class="cm">${meta}</div>`;
    g.appendChild(d);
  }

  // Last night
  renderLN(data);
}

function renderOL(data){
  const s=document.getElementById('olstrip');s.innerHTML='';
  const now=new Date(),ao=akOff(now),an=new Date(now.getTime()+ao*3600000);
  const labs=['Tonight','Tomorrow Night',''];
  const d3=new Date(an);d3.setDate(d3.getDate()+2);
  labs[2]=d3.toLocaleDateString('en-US',{weekday:'long',timeZone:'America/Anchorage'})+' Night';
  for(let i=0;i<3;i++){
    const kp=data.nMax[i]||0;
    let lv,lb,ds;
    if(kp>=5){lv='g';lb='Great chance';ds='Strong activity';}
    else if(kp>=4){lv='p';lb='Good chance';ds='Moderate-strong';}
    else if(kp>=3){lv='p';lb='Possible';ds='Some activity';}
    else if(kp>=2){lv='c';lb='Maybe';ds='Mild ‚Äî northern areas';}
    else if(kp>0){lv='u';lb='Quiet';ds='Low activity';}
    else{lv='u';lb='No data';ds='Forecast pending';}
    const cd=document.createElement('div');cd.className='olcard'+(i===0?' ist':'');
    cd.innerHTML=`<div class="olday">${labs[i]}</div><div class="oldot d${lv}"></div><div class="ollbl">${lb}</div><div class="oldesc">${ds}</div>`;
    s.appendChild(cd);
  }
}

function renderLN(data){
  const sec=document.getElementById('lnSec'),kp=data.lnMax;
  if(kp<=0){sec.style.display='none';return;}
  sec.style.display='block';
  const t=document.getElementById('lnTitle'),d=document.getElementById('lnDesc');
  if(kp>=5){t.textContent='Last night was a strong aurora night!';d.textContent=`Activity peaked at Kp ${kp.toFixed(1)} ‚Äî a solid storm. Aurora was likely visible across most of Alaska. If you saw it, nice catch!`;}
  else if(kp>=3){t.textContent='Some activity last night';d.textContent=`Reached Kp ${kp.toFixed(1)} overnight. Fairbanks and Denali probably had a show. Check tonight's forecast above for another shot.`;}
  else{t.textContent='Quiet night last night';d.textContent=`Only Kp ${kp.toFixed(1)} ‚Äî too low for most locations except possibly Fairbanks.`;}
}

// DETAIL PAGE
function renderDet(id){
  const f=AF.find(l=>l.id===id);if(!f)return;
  document.getElementById('dash').style.display='none';
  const det=document.getElementById('det');det.className='det active';

  let spotsH='';
  if(f.spots&&f.spots.length)spotsH=`<div class="icard"><h3>üìç Best viewing spots</h3><ul class="slist">${f.spots.map(s=>`<li><div class="sn">${s.n}</div><div class="sd">${s.d}</div></li>`).join('')}</ul></div>`;

  const others=AF.filter(l=>l.id!==id);
  const chips=others.map(o=>{const c=o.lv==='g'?'var(--grn)':o.lv==='p'?'var(--ylw)':o.lv==='c'?'var(--orn)':'var(--red)';return`<div class="ochip" onclick="nav('${o.id}')"><div class="cdot" style="background:${c}"></div>${o.name}</div>`;}).join('');

  // Location-specific 3-night
  let olH='';
  if(GD&&GD.nMax){
    const nts=['Tonight','Tomorrow',''];
    const d3=new Date(GD.an);d3.setDate(d3.getDate()+2);nts[2]=d3.toLocaleDateString('en-US',{weekday:'short',timeZone:'America/Anchorage'});
    olH='<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:18px;">';
    for(let i=0;i<3;i++){
      const nk=GD.nMax[i]||0;
      let nl;if(nk>=f.kpG)nl='g';else if(nk>=f.kpV+1)nl='p';else if(nk>=f.kpV)nl='c';else nl='u';
      const nlb=nl==='g'?'Great':nl==='p'?'Possible':nl==='c'?'Maybe':'Unlikely';
      const dc=nl==='g'?'var(--grn)':nl==='p'?'var(--ylw)':nl==='c'?'var(--orn)':'var(--red)';
      olH+=`<div style="text-align:center"><div style="font-size:.7rem;color:var(--t3);margin-bottom:6px;text-transform:uppercase;letter-spacing:.06em">${nts[i]}</div><div style="width:14px;height:14px;border-radius:50%;background:${dc};margin:0 auto 6px;box-shadow:0 0 10px ${dc}"></div><div style="font-size:.8rem;font-weight:500">${nlb}</div></div>`;
    }
    olH+='</div>';
  }

  const moonNote=f.moonPct>80?'üåï Bright moon tonight ‚Äî strong aurora will still be visible but faint displays may be washed out.':f.moonPct>50?'üåó Half moon ‚Äî won\'t block strong aurora but fainter displays will be harder to see.':f.moonPct>20?'üåí Slim moon ‚Äî good conditions for seeing even faint aurora.':'üåë New moon or very thin crescent ‚Äî ideal dark sky conditions!';

  det.innerHTML=`
    <button class="back" onclick="nav('')">‚Üê All locations</button>
    <div class="olocs">${chips}</div>
    <div class="dhero lv-${f.lv}">
      <div class="dname">${f.name}</div>
      <div class="dverdict">${f.v}</div>
      <div class="dstats">
        <div class="dstat"><div class="dsv">${f.ll}</div><div class="dsl">Tonight</div></div>
        <div class="dstat"><div class="dsv">${fmt(f.dw.start)}</div><div class="dsl">Gets dark</div></div>
        <div class="dstat"><div class="dsv">${f.cloudDesc||'‚Äî'}</div><div class="dsl">Sky tonight</div></div>
      </div>
      ${olH}
      <button class="sbtn" onclick="share('${f.id}')">üì§ Share forecast</button>
    </div>

    ${spotsH}

    <div class="icard"><h3>üåô Viewing window tonight</h3><p>${fmt(f.dw.start)} to ${fmt(f.dw.end)}. Darkest hours (11 PM ‚Äì 3 AM) tend to be best, but aurora can appear any time it's dark. Give your eyes 15‚Äì20 min to adjust. Your phone camera picks up aurora before your eyes ‚Äî try a long-exposure shot if unsure.</p></div>
    <div class="icard"><h3>üåï Moon conditions</h3><p>${moonNote} Moon is ${f.moonPct}% illuminated tonight.</p></div>
    ${f.drive&&f.drive!=='‚Äî'?`<div class="icard"><h3>üöó Getting there</h3><p>${f.drive}. ${f.id==='juneau'?'Accessible by air or Alaska Marine Highway ferry only ‚Äî no road connection.':'Drive time from Anchorage via the Parks Highway or Seward Highway depending on direction.'}</p></div>`:''}
    <div class="icard"><h3>üèîÔ∏è About ${f.name}</h3><p>${f.seo}</p></div>
    <div class="icard nerd" onclick="this.querySelector('.ndata').style.display=this.querySelector('.ndata').style.display==='block'?'none':'block'"><h3>üî¨ Technical details <span style="font-weight:300;color:var(--t3);font-size:.78rem">(tap)</span></h3><div class="ndata"><p><strong>Current Kp:</strong> ${cKp.toFixed(1)}<br><strong>Forecast Kp tonight:</strong> ${f.kp.toFixed(1)}<br><strong>Min Kp for visibility:</strong> ${f.kpV}<br><strong>Kp for strong display:</strong> ${f.kpG}<br><strong>Solar wind Bz:</strong> ${cBz.toFixed(1)} nT ${cBz<-5?'(southward ‚Äî favorable)':cBz<0?'(slightly southward)':'(northward ‚Äî less favorable)'}<br><strong>Cloud cover est:</strong> ${f.cloudPct}%<br><strong>Moon:</strong> ${f.moonPct}%<br><strong>Score:</strong> ${f.score}/100<br><strong>Coords:</strong> ${f.lat}¬∞N, ${Math.abs(f.lon)}¬∞W</p></div></div>

    <div class="asec" style="margin-top:20px">
      <div class="atitle">Get ${f.name} aurora alerts</div>
      <div class="adesc">We'll email you when conditions look great here.</div>
      <div class="aform" id="aformD"><input type="email" class="ainput" placeholder="your@email.com" id="aEmailD"><button class="abtn" onclick="doSignup('aEmailD','aformD','aokD','aerrD','${f.name}')">Notify me</button></div>
      <div class="aok" id="aokD">You're on the list!</div>
      <div class="aerr" id="aerrD"></div>
    </div>`;

  window.scrollTo({top:0,behavior:'smooth'});
  document.title=`${f.name} Aurora Forecast ‚Äî Alaska Glow`;
}

// NAVIGATION
function nav(id){
  if(id){window.location.hash='#/'+id;}
  else{window.location.hash='';document.getElementById('det').className='det';document.getElementById('dash').style.display='block';document.title='Alaska Glow ‚Äî Aurora Forecast for Tonight';window.scrollTo({top:0,behavior:'smooth'});}
}
window.addEventListener('hashchange',()=>{
  const h=window.location.hash;
  if(h.startsWith('#/')){const id=h.slice(2);if(AF.find(l=>l.id===id))renderDet(id);}
  else{document.getElementById('det').className='det';if(AF.length)document.getElementById('dash').style.display='block';document.title='Alaska Glow ‚Äî Aurora Forecast for Tonight';}
});

// SHARING
async function share(id){
  const f=AF.find(l=>l.id===id);if(!f)return;
  const t=`Aurora forecast for ${f.name} tonight: ${f.ll}. ${f.cloudDesc||''}\n\nCheck conditions ‚Üí alaskaglow.com/#/${f.id}`;
  if(navigator.share){try{await navigator.share({title:`Aurora ‚Äî ${f.name}`,text:t,url:`https://alaskaglow.com/#/${f.id}`});}catch(e){}}
  else{try{await navigator.clipboard.writeText(t);alert('Copied!');}catch(e){}}
}

// EMAIL SIGNUP (Resend via Netlify Function)
async function doSignup(inputId,formId,okId,errId,location){
  const email=document.getElementById(inputId).value;
  if(!email||!email.includes('@')){alert('Please enter a valid email.');return;}
  const errEl=document.getElementById(errId);
  errEl.style.display='none';
  try{
    const res=await fetch('/.netlify/functions/subscribe',{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({email,location})
    });
    if(res.ok){
      document.getElementById(formId).style.display='none';
      document.getElementById(okId).style.display='block';
    }else{
      const data=await res.json().catch(()=>({}));
      // Fallback: save locally if function not deployed yet
      const s=JSON.parse(localStorage.getItem('ag_signups')||'[]');
      s.push({email,location,date:new Date().toISOString()});
      localStorage.setItem('ag_signups',JSON.stringify(s));
      document.getElementById(formId).style.display='none';
      document.getElementById(okId).style.display='block';
    }
  }catch(e){
    // Offline fallback
    const s=JSON.parse(localStorage.getItem('ag_signups')||'[]');
    s.push({email,location,date:new Date().toISOString()});
    localStorage.setItem('ag_signups',JSON.stringify(s));
    document.getElementById(formId).style.display='none';
    document.getElementById(okId).style.display='block';
  }
}

// STARS
function genStars(){const c=document.getElementById('stars');for(let i=0;i<80;i++){const s=document.createElement('div');s.className='star';s.style.left=Math.random()*100+'%';s.style.top=Math.random()*60+'%';s.style.animationDelay=Math.random()*3+'s';s.style.animationDuration=(2+Math.random()*3)+'s';s.style.width=s.style.height=(1+Math.random()*1.5)+'px';c.appendChild(s);}}

// INIT
async function init(){
  genStars();
  try{
    const data=await loadData();GD=data;
    const fc=L.map(l=>score(l,data.tMax,cBz,data.moonPct));
    renderDash(fc,data);
    // Handle hash
    const h=window.location.hash;
    if(h.startsWith('#/')){const id=h.slice(2);if(AF.find(l=>l.id===id))renderDet(id);}
  }catch(e){
    console.error(e);
    document.getElementById('loading').innerHTML='<div style="text-align:center;padding:40px;color:var(--t2)"><h2 style="font-size:1.1rem;margin-bottom:8px">Couldn\'t load aurora data</h2><p style="color:var(--t3)">NOAA may be temporarily unavailable. Refresh to try again.</p></div>';
  }
}
init();
</script>
</body>
</html>
